---
title: "ERA 5 calibration to Elexon power"
author:
  - "S. Gomez$^1$"
institute:
   - $^1$School of Mathematics, University of Edinburgh
institute-short: "UoE"
date: "2025-11-04"
format: 
  beamer:
    theme: Rochester
    colortheme: spruce
    fonttheme: professionalfonts
    fig-cap-location: top
    toc: true
    split-bib: true
    output-file: "era5_calibration_slides.pdf"
header-includes:
  - \usepackage{graphicx}
fontsize: 12pt
aspectratio: 169
editor: source
nocite: "@*"
---

```{r include=FALSE}
require(tidyverse)
require(kableExtra)
require(parallel)
require(dplyr)
require(scales)
require(ggsci)

require(jsonlite)
require(httr)

require(data.table)
require(sf)
library(rnaturalearth)
library(rnaturalearthdata)

require(plotly)
require(ggthemes)
require(arrow)
path <- "~/Documents/elexon"
```

```{r}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, cache = FALSE)
```
# Calibration to power {#sec-intro}

## Updates

- Curtailment data to obtain potential generation
- Power curve comparison to data
- ERA 5 wind speed conversion to power


## ERA5 vs Elexon generation
Calibrate a ERA5 driven estimate to actual observed output accounting for spatiotemporal properties.

\vspace{0.2cm}
\begin{columns}[T, totalwidth=\textwidth]
  \begin{column}{0.5\textwidth}
    \centering
    \textbf{\small ERA5 at wind farms}\\[0.5em]
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/era5_at_windfarms.eps}
  \end{column}

  \begin{column}{0.5\textwidth}
    \centering
    \textbf{\small Elexon wind farms map (2025)}\\[0.5em]
    \vspace{-0.2cm}
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/wind_farms_elexon_size_2025.jpeg}
  \end{column}
\end{columns}


# ERA5 {#sec-gwa}

## Characteristics

\begin{columns}[T, totalwidth=\textwidth]
   \begin{column}{0.4\textwidth}
    % set font size for itemize levels locally
    {
    \setbeamerfont{itemize/enumerate body}{size=\fontsize{9}{10}\selectfont}
    \setbeamerfont{itemize/enumerate subbody}{size=\fontsize{8}{10}\selectfont}

    \begin{itemize}
      \item 5th generation of ECMWF's global reanalysis
      \item Spatial resolution $0.25^\circ \times 0.25^\circ$ (31km $\times$ 31 km at equator)
      \item Hourly temporal resolution
      \item Heights: 10m, 100m
    \end{itemize}
    } % end local font block
  \end{column}

  % Right column: figure
  
  \begin{column}{0.6\textwidth}
    \centering
    \small Average monthly wind speed and 90 CI
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/ws_uk_1s.pdf}
  \end{column}

\end{columns}

## ERA5 series

::: {.columns}

::: {.column width="50%"}
\centering
    \small Wind speed seasonality
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/ws_uk_1s_seas.eps}
:::

::: {.column width="50%"}
\centering
    \small Wind speed by location type
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/ws_uk_tech.eps}
:::

:::


## ERA5 wind direction at wind farms

::: {.columns}

::: {.column width="50%"}
\centering
    \small Wind direction frequency
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/wd_uk_1s.eps}
:::

::: {.column width="70%"}
\centering
    \small Seasonal patterns
    \includegraphics[width=\linewidth,height=7cm,keepaspectratio]{../fig/wd_uk_1s_seas.eps}
:::

:::


# Elexon data {#sec-elexon}

## BMU wind data

\begin{columns}[T, totalwidth=\textwidth]
   \begin{column}{0.5\textwidth}
    % set font size for itemize levels locally
    {
    \setbeamerfont{itemize/enumerate body}{size=\fontsize{9}{10}\selectfont}
    \setbeamerfont{itemize/enumerate subbody}{size=\fontsize{8}{10}\selectfont}

    \begin{itemize}
      \item 150 wind farms split in over 216 units
      \item Total capacity: 27 GW
      \item Half hourly resolution
      \item Records starting in 2019
      \item Curtailment (pending)
      \item Location / turbine data unavailable
    \end{itemize}
    } % end local font block
  \end{column}

  % Right column: figure
  \begin{column}{0.5\textwidth}
    \centering
    \small Wind installed capacity
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/wind_capacity_type_2025_nt.eps}
  \end{column}

\end{columns}

## BMU wind data

\small BMU wind generation (2024) 
```{r}
pot_summary <- fread(
  file.path("../data/hist_pot.csv")
)

# on shore off shore distribution
pot_summary %>% 
    group_by(tech_typ) %>%
    summarise(
        total_gen = sum(quantity, na.rm = TRUE)/1000,
        total_curt = sum(curtailment, na.rm = TRUE)/1000,
        total_pot = sum(potential, na.rm = TRUE)/1000,
        total_cap = sum(capacity, na.rm = TRUE),
        n_hours = sum(n_hours),
        n = n()
    ) %>% 
    janitor::adorn_totals("row") %>%
    mutate(
        cap_factor = total_gen*1000 / (total_cap )/(n_hours/n/2),
        pot_factor = total_pot*1000 / (total_cap )/(n_hours/n/2)
    ) %>% select(-n_hours) %>% 
    kable(
        col.names = c("Type", "Generation (GWh)", "Curtailment", "Potential" ,"Capacity (MW)", "Number of BMUs", "CF","PF"),
        digits = c(0,0,0,0,0,0,2,2),
        format = "latex",
        format.args = list(big.mark = ",")) %>%
    kable_styling(latex_options = c("scale_down"))
```

## Capacity factor through time

::: {.columns}

::: {.column width="50%"}
\centering
    \small Capacity factor by year
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/capacity_factor2.pdf}
:::

::: {.column width="50%"}
\centering
    \small Capacity factor by quarter
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/capacity_factor2_q.pdf}
:::

:::

## Curtailment through time

::: {.columns}

::: {.column width="50%"}
\centering
    \small Curtailment by year
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/curtailment_factor.pdf}
:::

::: {.column width="50%"}
\centering
    \small Curtailment seasonality
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/curtailment_factor_q.pdf}
:::

:::


## Potential generation

::: {.columns}

::: {.column width="50%"}
\centering
    \small Potential by year
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/potential_factor.pdf}
:::

::: {.column width="50%"}
\centering
    \small Potential seasonality
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/potential_factor_q.pdf}
:::

:::

## Renewable energy planning database (REPD)

```{r}
repd0 <- fread(file.path(path,"renew_energ_plan_db", "repd-q2-jul-2025.csv")) %>% 
    rename(
    tech_typ = `Technology Type`,
    devel_stat = `Development Status (short)`,
    capacity_repd = `Installed Capacity (MWelec)`,
    capacity_turb = `Turbine Capacity`,
    n_turb = `No. of Turbines`,
    height_turb = `Height of Turbines (m)`,
    x_coord = `X-coordinate`,
    y_coord = `Y-coordinate`)
names(repd0) <- tolower(gsub(" ", "_", names(repd0)))

```

::: {.columns}

::: {.column width="50%"}

\setbeamerfont{itemize/enumerate body}{size=\fontsize{9}{10}\selectfont}
\setbeamerfont{itemize/enumerate subbody}{size=\fontsize{8}{10}\selectfont}
\begin{itemize}
      \item Official UK government renewable data
      \item Over 800 wind farms listed as operational
      \item Coordinates available 
      \item Also available:
      \begin{itemize}
        \item Development status 
        \item Number of turbines
        \item Turbine capacity
        \item Turbine height (for some only)
      \end{itemize}
    \end{itemize}
:::

::: {.column width="50%"}
\centering
\small REPD wind farms
\vspace{0.2cm}
```{r}
reduced_table <- repd0 %>%
  filter(
    grepl("Wind", tech_typ),
    devel_stat %in% c("Operational", "Under Construction")
  ) %>%
  group_by(tech_typ, devel_stat) %>%
  summarise(
    n = n_distinct(ref_id),
    capacity = sum(capacity_repd, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  janitor::adorn_totals(where = "row")

kable(
  reduced_table,
  col.names = c("Type", "Development Status","Count","Capacity MW"),
  digits = 0,
  format = "latex",
  format.args = list(big.mark = ",")
) %>% 
    kable_styling(
        latex_options = c("scale_down")
    )
```
:::
:::

## Turbine data available

::: {.columns}

::: {.column width="50%"}
\centering
    \small Turbine capacity histogram
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/hist_turb_capacity_2025.eps}
:::

::: {.column width="50%"}
\centering
    \small Number of turbines histogram
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/hist_n_turb_2025.eps}
:::

:::

## Turbine data available

::: {.columns}

::: {.column width="50%"}
\centering
Turbine Height availability
\vspace{1cm}
```{r}
ref_catalog_2025 <- fread(
  file.path("../data/ref_catalog_wind_2025.csv.gz")) 
ref_catalog_2025 %>% 
    mutate(heightNA = is.na(height_turb)) %>% 
    group_by(tech_typ, heightNA) %>% 
    summarise(
        height = mean(height_turb, na.rm = TRUE),
        n = n()
    ) %>% 
    kable(
        col.names = c("Type","Height available", "Average height (m)","count"),
        digits = 1,
        format = "latex"
    ) %>% 
    kable_styling(
        latex_options = c("scale_down")
    )

```

:::

::: {.column width="50%"}
\centering
    \small Turbine height histogram
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/hist_turb_height_2025.eps}
:::

:::

# Power conversion {#sec-power_curves}

## Generic power curves

::: {.columns}

::: {.column width="50%"}

\setbeamerfont{itemize/enumerate body}{size=\fontsize{9}{10}\selectfont}
\setbeamerfont{itemize/enumerate subbody}{size=\fontsize{8}{10}\selectfont}
\begin{itemize}
      \item Using 3 generic power curves
      \item Offshore plus the IEC 3 classes
      \item Assigning class based on GWA mean wind speed at location
      \item Rescaling rated power to turbine capacity
\end{itemize}

\vspace{0.2cm}
\centering
IEC classification

\vspace{0.2cm}
\resizebox{\linewidth}{!}{%
\begin{tabular}{l c c l}
\toprule
Class & Mean wind speed  & Extreme 10-min & Typical sites \\
 & at hub height (m/s) &  gust (m/s) \\
\midrule
I   & 10   & 70   & Very windy / exposed sites \\
II  & 8.5  & 59.5 & Moderate wind sites \\
III & 7.5  & 52.5 & Low-wind / inland sites \\
\bottomrule
\end{tabular}
}
:::

::: {.column width="50%"}
\centering
    \small Generic power curves (PC$_k$)
    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/generic_power_curves_uncens.eps}
:::

:::
## Power estimate based on generic power curves

For each location $i$ we have: 

- observed raw power $\tilde p_{it}$
- curtailment amount $a_{it}$
- potential output $p_{it} = \tilde p_{it} + a_{it}$
- wind farm capacity $c_i$
- turbine height $v_i$
- ERA5 wind speed $w_{it}$.

## Power estimate based on generic power curves

An initial estimate will require:
\begin{itemize}
  \item Mapping location to a rescaled power curve $\widetilde \text{PC}_k$
  \item Estimate wind farm power in GWh
\end{itemize}

\begin{equation*}
    \hat p_{it} = \widetilde \text{PC}_{k} (w_{it})
\end{equation*}

## Generic power curves vs observed data - Fallago Rig
\begin{columns}[T, totalwidth=\textwidth]

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with raw generation}
    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_T_FALGW-1_valq0.pdf}
    
  \end{column}

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with potential generation}

    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_T_FALGW-1_valpot.pdf}
  \end{column}

\end{columns}

## Generic power curves vs observed data - Viking
\begin{columns}[T, totalwidth=\textwidth]

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with raw generation}
    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_T_VKNGW-1_valq0.pdf}
    
  \end{column}

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with potential generation}

    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_T_VKNGW-1_valpot.pdf}
  \end{column}

\end{columns}

## Generic power curves vs observed data - Hornsea 1
\begin{columns}[T, totalwidth=\textwidth]

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with raw generation}
    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_HOWAO-1_valq0.pdf}
    
  \end{column}

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with potential generation}

    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/pc_comparison_HOWAO-1_valpot.pdf}
  \end{column}

\end{columns}

## Generic power curves vs observed data - Seagreen 1
\begin{columns}[T, totalwidth=\textwidth]

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with raw generation}
    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_T_SGRWO-1_valq0.pdf}
    
  \end{column}

  \begin{column}{0.5\textwidth}
    \centering
    {\small Comparison with potential generation}

    \includegraphics[
      width=\linewidth,
      height=5cm,keepaspectratio]{
        ../fig/pc_comparison_T_SGRWO-1_valpot.pdf}
  \end{column}

\end{columns}

## ERA5 based estimates vs Elexon 2025
\begin{columns}[T, totalwidth=\textwidth]

  % Left column: Power curve
  \begin{column}{0.5\textwidth}
    \centering
    {\small Fallago Rig}
\includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/falgw_conv.pdf}
    
  \end{column}

  % Right column: Expected power
  \begin{column}{0.5\textwidth}
    \centering
    {\small Hornsea}

    \includegraphics[width=\linewidth,height=5cm,keepaspectratio]{../fig/howao_conv.pdf}
  \end{column}

\end{columns}


## Next Steps

\begin{itemize}
   \item Data on planned unavailability
   \item Learn power curve from history
   \item Quantile mapping calibration
\end{itemize}